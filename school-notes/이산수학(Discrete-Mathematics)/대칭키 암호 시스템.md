# 대칭키 암호 시스템
## 암호의 역사
### 기본 용어
> 암호에서 사용하는 대표적인 이름이 있다(변수 x, y, i 처럼)
>
>> 앨리스: 메시지를 전송하거나 전송된 메시지를 수신하는 인물
>>
>> 밥: 앨리스와 함께 암호 통신을 하는 인물
>>
>> 이브: 앨리스와 밥이 암호 통신을 하면 중간에서 해당 메시지를 도청하거나 내용을 수정하는 인물

- **평문**: 암호화 하기 전의 메시지
- **암호문**: 암호화 한 후의 메시지
- **암호 기술**: 중간에서 도청자가 암호문을 가로채더라도 암호문으로부터 평문의 내용을 알 수 없도록 만드는 기술
<br/><br/>

- **암호화(`encrypt`)**: 평문을 암호문으로 바꾸는 과정
- **복호화(`decrypt`)**: 암호문을 평문으로 복구하는 과정
<br/><br/>

- **암호 해독(암호 공격)**: 보내는 사람(송신자)와 받는 사람(수신자) 이외의 사람이 암호문으로부터 평문의 내용을 알아내려고 시도하는 것
  - 가장 기본적으로 해킹, 그리고 해킹을 방지하기 위한 시도 등
- **암호화 알고리즘**: 평문을 암호문으로 바꾸는 과정을 알고리즘으로 표현한 것
- **복호화 알고리즘**: 암호문을 평문으로 바꾸는 과정을 알고리즘으로 표현한 것
- **키**: 암호화 또는 복호화에 필요한 정보

#### 암호화와 복호화의 수학적 표현
- $C = E_{K}P$:
  - 평문 P를 키 K와 암호화 알고리즘(**E**ncrypt)을 이용하여 암호문 C를 얻는다.
- $P = D_{C}P$:
  - 암호문 C를 키 K와 복호화 알고리즘(**D**ecrypt)을 이용하여 평문 P를 얻는다

`P`: `Plaintext`
`K`: `Key`
`C`: `Ciphertext

### 시저 암호와 치환 암호
`시저암호`: 로마 황제 율리우스 시저에서 따온 이름.
평문에 사용되는 알파벳을 `일정한 문자 수만큼 평행 이동`시킴으로서 암호화.

암호화 예:
- I love you **=> L oryh brx**

영어 알파벳은 총 26개의 문자로 이루어져 있으므로 암호화 키는 0 ~ 25까지 정해줄 수 있었다.

#### 시저 암호의 단점
지금 기준으로는 너무 쉽고 취약한 암호 시스템이다.
**`전수조사공격`에 취약하다.**
- 전수조사공격(`Brute-Force Attack`)
  - **키가 될 수 있는 모든 가능한 수보들을 시도해 보는 방법**
- 시저 암호의 키가 될 수 있는 경우가 26개이기 때문에 의미 있는 문장이 나올 때까지 모든 가능한 경우를 조사할 수 있다.
- 즉, **키 공간이 좁으면 암호가 안전하지 않다.**

#### 단일 치환 암호
**평문에 사용되는 알파벳을 `다른 알파벳`으로 변환하는 암호**

`I love you` **=> `W sgby xgn`**
즉, 시저암호가 단일 치환 암호의 일종이다.
단, 평행이동이 아니라 무작위로 배치한 것이 다르다.

:?: **치환암호는 안전한가?**
`단일 치환 암호의 키 공간 크기` = $26! = 4.0 \times 10^{26}$

키 공간이 매우 커서 안전해 보일 수 있다.
그러나 만약 메시지가 매우 길면 어떨까?

---
### 빈도 분석 공격법

보통 알파벳의 사용 빈도수는 굉장히 다르다.
특히, 알파벳`e`의 사용 빈도가 굉장히 높으며, 암호문에서 가장 많이 사용된 알파벳을 `e`로 치환함으로서 유추가 가능하다.

> **3글자의 단어에서 `e`가 마지막으로 사용되는 단어를 `the`로 가정할 수 있다.**

결론적으로, **전수조사공격에 대한 안정성이 암호의 안전성을 보장하지는 않는다**는 것이다.

:?: 그래서 `빈도 분석 공격법`에 안전하려면?
**다중 치환 암호**를 사용한다.

### 다중 치환 암호

- 첫 번째 알파벳은 첫 번째 치환표로 암호화
- 두 번째 알파벳은 두 번째 치환표로 암호화

사람이 하기에 굉장히 복잡해 보이고 실수가 많이 생길것같지 않은가?

이 때 사용된 기계가 바로 **`Enigma`(에니그마)** 다.
- 2차 세계대전 당시 **나치 독일군이 사용한 암호체계**
- 회전하는 원판과 전기 회로를 사용하여 `강력한 다중 치환 암호체계`를 만듬
- 영국의 암호해독팀에 의해 해독법이 발견되었다.(영국의 승리 원인)
  - `앨런 튜링`

> **현대 암호는 치환 암호를 다른 방식으로 사용하여 암호의 안정성을 높였다.**

---
## 대칭키 암호
### 보안 서비스
보안 서비스를 제공하기 위해선 여러가지를 고려해야한다.
>:?: 내가 받은 이메일을 정말 Bob이 받았을까?
>>- **`인증`**
>
>:?: 이메일을 중간에 다른 사람이 변조하지 않았을까?
>>- **`무결성`**
>
>:?: Bob과의 이메일을 다른 사람이 보면 어떡하지?
>>- **`기밀성`**

등, 보안 서비스를 제공하기 위해 고려야해야 할 점들이 있으며
크게 보안 서비스의 기반 기술에는 5가지가 있다.

- **`기밀성(Confidentiality)`**:
  - 메시지의 내용을 다른 사람에게 비밀로 유지하는 것
- **`인증(Authentication)`**:
  - 내가 나임을 다른 사람에게 증명하는 것
  - 패스워드, 지문 인식, ...
- **`무결성(Integrity)`**:
  - 메시지의 내용이 중간에 변형되지 않았음을 보장하는 것
- **`부인 방지(Non-Repudiation)`**:
  - 자신이 한 행동을 부인하지 못하게 하는 것
- **`접근 제어(Access Control)`**:
  - 기밀 정보에 대한 접근을 통제하는 것

#### 암호기술의 종류
1. `대칭키` 암호시스템
2. `공개키` 암호시스템
3. 전자 `서명`
4. 일방향 `해시 함수`
5. 메시지 `인증코드`

#### 보안서비스와 암호기술의 관계
| 보안 서비스 | 암호 기술 |
| :---: | :---: |
|기밀성|대칭키 암호, 공개키 암호|
|무결성|해시 함수|
|인증|전자 서명, 메시지 인증코드|
|부인 방지|전자 서명|

### 대칭키 암호 시스템
:?:암호 시스템이란?
1. 평문을 암호화 알고리즘을 통해 암호문을 만든다.
2. 암호문을 복호화 알고리즘을 통해 평문을 만든다.

여기서 암호화 키와 복호화 키가 알고리즘의 역할을 해주는데 이 키가 같냐 다르냐에 따라 용어가 달라진다.


암호화 키 === 복호화 키 : `대칭 키(비밀 키)암호`
- 시저 암호, 치환 암호 / DES, AES, ...
- 사전에 키를 공유하는 과정이 필요하다.

암호화 키 !== 복호화 키 : `비대칭 키(공개 키)암호`
- 1976년 이후 등장
- RSA, ECC, ...

대칭키 암호 시스템을 먼저 공부해보자.
~~비대칭 키 암호는 다른 링크에서~~

K = 암호화 키 = 복호화 키
즉 키가 사전에 합의되어야 하는데 여기서 **`키 분배 문제`**가 발생한다.

사람 수가 많아지면 많아질수록 많은 키가 필요해진다.
- 한사람이 관리해야 하는 키 = $N - 1$
- 시스템 전체가 관리해야 하는 키 = $\begin{pmatrix}
  N\\2
\end{pmatrix} = \frac{N(N-1)}{2}$


고전 암호: **문자 단위**로 암호화
- I love you => (`시저 암호`) => L oryh brx

현대 암호: **비트열**을 암호화
- `ASCII`(아스키)코드를 통해 비트열로 만든 후 암호화 한다.
- I love you => (`ASCII` 코드표) => 6C 6F 76 65 20 6D 65 3F => (`DES`) => 73 21 26 2A 71 7E 2A 58 => s!&*q~*X

### DES 대칭키 암호 알고리즘
**`Data Encryption Standard`**
- 1973/ 미 상무성에서 순수 민간용 표준 암호알고리즘 공모
- 1974/ IBM에서 `Lucifer 알고리즘`으로 응모
- 1977/ `NSA에서 Lucifer를 수정하여 DES로 명명(FIPS-46), 이후 안전성을 5년마다 검토
- 1933/ 마지막 검토 이후 1998년까지 사용을 결정
- 1998/ 차세데 알고리즘 `AES`공모
- 2000/ `Rijndael이 최종 알고리즘으로 선정`됨
- 2001/ `Rijndael이 AES로 표준화`됨(FIPS-197)

**`DES의 전체 구조`**
평문의 크기: **64비트**
암호문의 크기: **64비트**
키의 크기: **56비트**
-> `DES 키 공간의 크기` = $2^{56}$

**DES 현황**
- DES에 대한 전수조사 공격
  - 1997/ `DES Challenge I`:  96일
  - 1998/ `DES Challenge II-1`: 41일
  - 1998/ `DES Challenge II-2`: 56시간
  - 1999/ `DES Challenge III`: 22시간 15분

이에 따라 `DES`를 대체할 `블록 암호`가 필요했다.
- `TDES`(`Triple DES`), `AES`, ...
---
## 운영 모드
:?: 운영 모드가 왜 필요한가?
- 만약 데이터가 64-비트보다 크다면?
  - **운영모드**
- 만약 데이터가 64-비트보다 작다면?
  - **패딩**
  - 데이터의 크기가 암호 알고리즘이 동작하는 크기보다 작은 경우 여분의 데이터를 추가하는 방법

### 운영 모드의 개념
- 긴 평문을 **적절한 크기의 데이터 블록으로 나누어 암호화**하는 방법을 제공
- 각 블록에 암호 알고리즘을 반복해서 사용하여 긴 평문 전체를 암호화
- 주요 운영모드
  - `ECB(Electric CodeBook)`
  - `CBC(Cipher Block Chaining)`
  - `CFB(Cipher-Feedback)`
  - `OFB(Output-Feedback)`
  - `CTR(CounTeR)`

기본적인 운영모드인 `ECB`와 `CBC`를 알아보자.

### ECB 모드
- 암호화:
각 평문 블록을 독립적으로 암호화 한다.
필요시 패딩한다.
- 복호화:
각 암호문 블록을 독립적으로 복호화 한다.

**이해하기 쉽고 간단하다!**
암호화된 **모든 블록을 수신하지 않더라도 복호화 가능**하며
암,복호화 **모두 병렬 연산이 가능**하다.

그러나, 동일한 평문 블록은 동일한 암호문 블록으로 암호화 된다.
블록끼리 **독립적으로 암호화**된다.

따라서 어떤 블록끼리 같다라는것이 **유추가 가능**해져 단점으로서 작용한다.

### CBC 모드
`IV(Initialization Vector)`: 초기 벡터
- **첫 블록의 암호화**에 사용한다.
- 비밀일 필요가 없다.

같은 평문 블록이라도 **다른 암호문 블록**으로 암호화가 되서 좋으나 암호화에서 **병렬 처리가 불가능**하다.(복호화는 **병렬 처리가 가능**